# 中文规则识别引擎
请根据以下大纲，生成一系列用于规则匹配引擎的规则
## 1. 输入处理与意图分流
- **输入预处理与特征提取**
- **意图分类器**
  - 设备控制意图，用户想要控制车辆上的某个可以操作的硬件设备
  - 信息查询意图，用户想要查询车辆可以提供的参数，比如：车速、剩余电池容量、空调预设温度
  - 日常聊天意图 → 直接转LLM，使用 **LoalChatBot.py** 进行处理
  - 复杂指令识别 → 转LLM+Prompt模板，使用 **LocalChatBot.py** 进行处理

## 2. 交互分析操作
- **规则匹配处理**
  - 基础语法分析
  - 实体识别与槽位填充
- **LLM调用接口**
  - 复杂指令检测
  - Prompt模板选择
  - LLM请求构建与发送

## 3. 设备交互操作
- **设备控制操作** (主动操作)
  - 可操作硬件控制，用户想要控制：空调、车窗 等可以被操作的车载硬件
  - 可操作硬件状态读取，用户想要查询：收音机当前频率、空调预设温度、车窗的开关
  - 不可操作硬件控制，用户想要控制不被允许操作，无法操作的硬件，比如：方向盘、刹车
  - 不可操作硬件状态读取，用户想要查询不可操作硬件的状态，比如：行车记录仪、倒车雷达
- **数据读取操作** (被动操作)
  - 传感器数据获取，用户想要查询车辆传感器数据，比如：当前车速、剩余电池容量、发动机/电机 的转速
  - 状态信息读取，车辆当前的状态：是否存在异常或者警告

## 4. 系统功能操作
- **软件系统功能**
  - 受控API调用，由应用程序提供的API，比如：高德地图、网易云音乐、本地多媒体播放，哔哩哔哩
  - 间接文件访问，一些需要访问文件的操作，比如：播放本地音乐
- **网络与服务访问**
  - 云服务交互，用户想要查询互联网上的信息：天气，股票，实时交通状况 等等

## 5. 对话管理操作
- **日常聊天处理** 直接LLM，调用 **LocalChatBot.py** 进行处理

# 规则引擎与LLM协同流程
以下是用户输入的处理步骤，展示规则引擎与LLM的混合工作流：

1. **输入预处理**
   - 清洗文本，去除标点与非法字符（所有自然语言文本均合法，诸如emoji之类的文字为非法字符）
   - 提取关键特征（动词/名词识别、否定词检测）

2. **意图分流决策树**
   ```mermaid
   graph TD
     A[用户输入] --> B{是否含设备关键词？}
     B -->|是| C[规则引擎处理]
     B -->|否| D{是否含复杂逻辑？}
     D -->|是| E[调用LLM+Prompt模板]
     D -->|否| F[直接转LLM聊天]
   ```

3. **规则与LLM的协作边界**
   | 场景                | 处理引擎       | 原因                                                                 |
   |---------------------|---------------|----------------------------------------------------------------------|
   | “打开空调”，“打开窗户”          | 规则引擎       | 简单指令，规则匹配更快                                |
   | “后排空调调至二十三度”  | 规则引擎+LLM解析       | 有明确指令，但是参数需要通过LLM解析                                    |
   | “副驾驶位空调太冷了”  | LLM+Prompt    | 需理解隐含意图（降低风速+调整出风口+调高温度）                                |
   | “讲个笑话”          | 纯LLM         | 无结构化操作需求                                                    |

4. **异常处理机制**
   - 规则引擎失败时自动触发LLM兜底
   - 涉及车载系统调用的时候，LLM输出结构化的Python字典类变量以调用API